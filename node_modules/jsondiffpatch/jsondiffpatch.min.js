/*
*   Json Diff Patch
*   ---------------
*   https://github.com/benjamine/JsonDiffPatch
*   by Benjamin Eidelman - beneidel@gmail.com
*/(function(){var e={};typeof jsondiffpatch!="undefined"&&(e=jsondiffpatch),e.config={textDiffMinLength:60},e.dateReviver=function(e,t){var n;if(typeof t=="string"){n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t);if(n)return new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6]))}return t};var t=function(){var t;e.config.diff_match_patch&&(t=new e.config.diff_match_patch.diff_match_patch),typeof diff_match_patch!="undefined"&&(typeof diff_match_patch=="function"?t=new diff_match_patch:typeof diff_match_patch=="object"&&typeof diff_match_patch.diff_match_patch=="function"&&(t=new diff_match_patch.diff_match_patch));if(t)return e.config.textDiff=function(e,n){return t.patch_toText(t.patch_make(e,n))},e.config.textPatch=function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i])throw new Error("text patch failed");return r[0]},!0},n=e.isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return typeof e=="object"&&e instanceof Array},r=e.isDate=function(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"},i=function(e,t){var n,r,i,s=t.length,o=e.length,a;a=function(r){i=u(e[r],t[r]),typeof i!="undefined"&&(typeof n=="undefined"&&(n={_t:"a"}),n[r]=i)};for(r=0;r<Math.max(s,o);r++)a(r);return n},s=function(e,t,n){var r,i=e.length,s=t.length,o,a=0;typeof n=="function"?o=n:o=function(e){return e[n]};for(var f=0;f<s;f++)typeof r=="undefined"&&(r={_t:"a"}),r[o(t[f])]=[t[f]],a++;for(var f=0;f<i;f++){var l=o(e[f]);if(typeof r=="undefined"||typeof r[l]=="undefined")typeof r=="undefined"&&(r={_t:"a"}),r[l]=[e[f],0,0],a++;else{var c=u(e[f],r[l][0]);typeof c=="undefined"?(delete r[l],a--):r[l]=c}}if(a>0)return r;return},o=function(e,t){var r,i,s,o;o=function(o){n(t[s])&&(t[s+"_key"]||t["_"+s+"_key"])&&(t[s]._key=t[s+"_key"]||t["_"+s+"_key"]),n(e[s])&&(e[s+"_key"]||e["_"+s+"_key"])&&(e[s]._key=e[s+"_key"]||e["_"+s+"_key"]),i=u(e[s],t[s]),typeof i!="undefined"&&(typeof r=="undefined"&&(r={}),r[s]=i)};for(s in t)t.hasOwnProperty(s)&&o(s);for(s in e)e.hasOwnProperty(s)&&typeof t[s]=="undefined"&&o(s);return r},u=e.diff=function(u,a){var f,l,c,h,p;if(u===a)return;if(u!==u&&a!==a)return;f=typeof a,l=typeof u,c=a===null,h=u===null,l=="object"&&r(u)&&(l="date");if(f=="object"&&r(a)){f="date";if(l=="date"&&u.getTime()===a.getTime())return}if(c||h||f=="undefined"||f!=l||f=="number"||l=="number"||f=="boolean"||l=="boolean"||f=="string"||l=="string"||f=="date"||l=="date"||f==="object"&&n(a)!=n(u)){p=[];if(typeof u!="undefined")if(typeof a!="undefined"){var d=f=="string"&&l=="string"&&Math.min(u.length,a.length)>e.config.textDiffMinLength;d&&!e.config.textDiff&&t(),d&&e.config.textDiff?p.push(e.config.textDiff(u,a),0,2):(p.push(u),p.push(a))}else p.push(u),p.push(0,0);else p.push(a);return p}return n(a)?a._key||u._key?s(u,a,a._key||u._key):i(u,a):o(u,a)},a=function(e,t){if(n(e)&&e._key){var r=e._key;typeof e._key!="function"&&(r=function(t){return t[e._key]});for(var i=0;i<e.length;i++)if(r(e[i])===t)return e[i];return}return e[t]};e.getByKey=a;var f=function(e,t,r){if(n(e)&&e._key){var i=e._key;typeof e._key!="function"&&(i=function(t){return t[e._key]});for(var s=0;s<e.length;s++)if(i(e[s])===t){typeof r=="undefined"?(e.splice(s,1),s--):e[s]=r;return}typeof r!="undefined"&&e.push(r);return}typeof r=="undefined"?n(e)?e.splice(t,1):delete e[t]:e[t]=r},l=function(t){return e.config.textDiffReverse||(e.config.textDiffReverse=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l,c=function(){f!==null&&(r[f]="-"+r[f].slice(1)),l!==null&&(r[l]="+"+r[l].slice(1),f!==null&&(s=r[f],r[f]=r[l],r[l]=s)),r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@",o=null,a=null,f=null,l=null};r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var h=i.slice(0,1);h==="@"?(o!==null,o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):h=="+"?(f=t,r[t]="-"+r[t].slice(1)):h=="-"&&(l=t,r[t]="+"+r[t].slice(1))}return o!==null,r.join("\n")}),e.config.textDiffReverse(t)},c=e.reverse=function(e){var t,i;if(typeof e=="undefined")return;if(e===null)return null;if(typeof e=="object"&&!r(e)){if(n(e)){if(e.length<3)return e.length==1?[e[0],0,0]:[e[1],e[0]];if(e[2]==0)return[e[0]];if(e[2]==2)return[l(e[0]),0,2];throw new Error("invalid diff type")}i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=c(e[t]));return i}return typeof e=="string"&&e.slice(0,2)==="@@"?l(e):e},h=e.patch=function(r,i,s,o){var u,l,c="",p;typeof i!="string"?(o=s,s=i,i=null):typeof r!="object"&&(i=null),o&&(c+=o),c+="/",i!==null&&(c+=i);if(typeof s=="object")if(n(s)){if(s.length<3)return l=s[s.length-1],i!==null&&f(r,i,l),l;if(s[2]!=0){if(s[2]==2){e.config.textPatch||t();if(!e.config.textPatch)throw new Error("textPatch function not found");try{l=e.config.textPatch(a(r,i),s[0])}catch(d){throw new Error('cannot apply patch at "'+c+'": '+d)}return i!==null&&f(r,i,l),l}throw new Error("invalid diff type")}if(i===null)return;f(r,i)}else if(s._t=="a"){p=i===null?r:a(r,i);if(typeof p!="object"||!n(p))throw new Error('cannot apply patch at "'+c+'": array expected');for(u in s)u!=="_t"&&s.hasOwnProperty(u)&&h(p,u,s[u],c)}else{p=i===null?r:a(r,i);if(typeof p!="object"||n(p))throw new Error('cannot apply patch at "'+c+'": object expected');for(u in s)s.hasOwnProperty(u)&&h(p,u,s[u],c)}return r},p=e.unpatch=function(e,t,n,r){return typeof t!="string"?h(e,c(t),n):h(e,t,c(n),r)};typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"&&define.amd?define(e):window.jsondiffpatch=e})();